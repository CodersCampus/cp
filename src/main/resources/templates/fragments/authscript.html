<script>
    const fbauth = document.querySelector('fbauth-element');
    const uid = document.getElementById('uid');
    const studentName = document.getElementById('student-name');
    const displayName = document.getElementById('display-name');
    const photoURL = document.getElementById('photo-url');

    fbauth.addEventListener('user-changed', (event) => {
        const {newValue} = event.detail;
        if (newValue) {
            if (uid) {
                uid.value = newValue.uid;
            }
            studentName.innerText = newValue.displayName;
            photoURL.src = newValue.photoURL;
            fetch("/send-oauth", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    displayName: newValue.displayName,
                    uid: newValue.uid,
                    photoURL: newValue.photoURL
                }),
            })
                .then(response => response.json());
        } else {
            if (uid) {
                uid.value = '';
            }
            studentName.innerText = '';
            photoURL.src = '';
        }
        if (newValue) {
            if (displayName) {
                displayName.value = newValue.displayName;
            }
            studentName.innerText = newValue.displayName;
            photoURL.src = newValue.photoURL;
        } else {
            if (displayName) {
                displayName.value = '';
            }
            studentName.innerText = '';
            photoURL.src = '';
        }
    });
</script>


